# BUSINESS_CASE.md — TCO/ROI и эффекты унификации AnyGate

## Резюме (Executive Summary)

**Проблема:** разнородный L7-слой (nginx/traefik/HAProxy + «самописные» стабы) увеличивает TCO, замедляет релизы, усложняет безопасность и наблюдаемость.
**Решение:** внедрить **AnyGate** как единый бинарь L7 (reverse-proxy, статика, fixed/echo, плагины, DSL), лицензия MIT, без платы за лицензии и vendor lock-in.
**Ожидаемый результат:** снижение инфраструктурных и операционных затрат, ускорение time-to-market, снижение инцидентов и отказ от дублей функционала.
**Запрос на одобрение:** утверждение унификации L7 на AnyGate и финансирование пилота и масштабирования согласно плану.

---

## 1. Исходная ситуация и болевые точки

* **Фрагментация стека:** разные прокси под разные задачи → разрозненные конфиги, несовместимое поведение, рост ошибок при изменениях.
* **Дублирование ролей:** отдельные файло-серверы для SPA, отдельные мок-сервисы, отдельные ingress-решения.
* **Высокий операционный след:** поддержка нескольких образов, политик TLS, лог-форматов, дашбордов.
* **Сложность соответствия требованиям безопасности:** неоднородность TLS/mTLS, разный уровень маскирования, разные циклы обновлений.
* **Замедление релизов:** маршрутизация и статика требуют изменений в разных компонентах и командах.

---

## 2. Целевое состояние

* **Единый L7-инструмент:** статика (`"/": "/dist/"`), обратное проксирование, фиксированные/echo-ответы, плагины (logger, rate, headers, cors, ip, auth).
* **Один DSL «в одну строку»:** предсказуемая маршрутизация и единая логика на всех средах.
* **Унифицированная наблюдаемость:** общий формат логов/метрик/трейсов, шаблонные алерты и дашборды.
* **MIT:** отсутствие лицензионных выплат и ограничений, гибкость форка при необходимости.

---

## 3. Модель стоимости (TCO)

### 3.1. Компоненты TCO до унификации

* **Infra:** CPU/RAM/диски/трафик под nginx/traefik/HAProxy + вспомогательные сервисы.
* **Ops:** поддержка конфигов, обновлений, hotfix, дежурства.
* **Sec:** разнородная политика TLS/mTLS, аудит и remediation.
* **Tooling:** поддержка нескольких пайплайнов CI/CD, образов и чартов.
* **Обучение и контекст-свитч:** разные синтаксисы/паттерны.

### 3.2. Компоненты TCO после унификации на AnyGate

* **Infra:** один бинарь, экономия на избыточных слоях; статика-из-коробки.
* **Ops:** единые пресеты и DSL, унифицированные playbooks.
* **Sec:** единый профиль TLS/mTLS, единые механики маскирования/логирования.
* **Tooling:** один образ, единые манифесты и проверка конфигураций.
* **Обучение:** одно руководство, один набор практик.

---

## 4. Источники экономии (Savings)

| Категория      | Механизм экономии                                                      | Как измерять                                                    |
| -------------- | ---------------------------------------------------------------------- | --------------------------------------------------------------- |
| Инфраструктура | Меньше прокси-слоёв и образов; статика без nginx                       | CPU/RAM/узел; число сервисов; счета облака                      |
| Операционка    | Единые конфиги/пайплайны; меньше изменений в нескольких слоях          | Часы SRE/платформы на выпуск релиза, количество ручных операций |
| Время релиза   | Один DSL, hot-reload; fixed/echo для моков                             | Время от коммита до доступности; параллельность фронт/бэк       |
| Инциденты      | Меньше поверхностей и различий; стандартизированные метрики/алерты     | Частота/длительность инцидентов, MTTR                           |
| Безопасность   | Единый TLS/mTLS, предсказуемое маскирование, меньше «забытых» апдейтов | Кол-во отклонений аудита; время закрытия уязвимостей            |

---

## 5. Финансовая модель (ROI)

### 5.1. Переменные (вставить свои значения)

* `N_nodes` — количество узлов с L7-слоем.
* `Cost_cpu_ram` — средняя стоимость CPU/RAM/узел в месяц (облако/ЦОД).
* `Ops_rate` — средняя стоимость часа SRE/платформы.
* `Ops_hours_release_before` / `Ops_hours_release_after` — средние часы на релиз до/после.
* `Releases_per_month` — релизов в месяц.
* `Incidents_before` / `Incidents_after` — инцидентов в месяц.
* `MTTR_before` / `MTTR_after` — средняя длительность инцидента (часы).
* `Business_cost_downtime` — стоимость часа простоя/деградации.
* `Migration_cost` — разовые затраты пилота и масштабирования (включая обучение и адаптацию манифестов).

### 5.2. Формулы

* **Экономия инфраструктуры/мес:**
  `Infra_savings = (Cost_cpu_ram_before − Cost_cpu_ram_after) × N_nodes`
* **Экономия операционки/мес:**
  `Ops_savings = (Ops_hours_release_before − Ops_hours_release_after) × Releases_per_month × Ops_rate`
* **Экономия на инцидентах/мес:**
  `Inc_savings = (Incidents_before × MTTR_before − Incidents_after × MTTR_after) × Business_cost_downtime`
* **Суммарная экономия/мес:**
  `Total_savings = Infra_savings + Ops_savings + Inc_savings`
* **ROI годовой:**
  `ROI = (Total_savings × 12 − Migration_cost) / Migration_cost`
* **Срок окупаемости (месяцы):**
  `Payback = Migration_cost / Total_savings`

### 5.3. Сценарии для чувствительности

* **Консервативный:** экономия только на Ops (без снижения инцидентов и инфры).
* **Базовый:** Ops + частичная инфра + сокращение MTTR.
* **Агрессивный:** всё из базового + снижение числа инцидентов и узлов.

> Finance заполняет переменные для всех сценариев и выбирает целевой.

---

## 6. Нематериальные выгоды (Intangibles)

* **Скорость экспериментов:** fixed/echo позволяют мокать сервисы без ожидания апстрима.
* **Снижение технологического долга:** один DSL, один подход к TLS/логам/метрикам.
* **Прозрачность и контроль:** единые дашборды и алерты для всех продуктов.
* **Аттрактивность для инженеров:** современный стек, понятные стандарты.

---

## 7. План внедрения

### 7.1. Пилот

* **Объект:** один домен/продукт (SPA + API).
* **Шаги:** аудит текущих правил → 1:1 перенос на AnyGate DSL → A/B трафик → замер метрик (квантили задержек, ошибки, ресурсы) → отчёт Sponsor/Finance.
* **Критерии выхода:** отсутствие регрессий и подтверждение целевых экономий в базовом сценарии.

### 7.2. Масштабирование

* **Шаблоны конфигов:** SPA only, API only, mixed.
* **Унификация CI/CD:** единый образ, пресеты helm/манифестов.
* **Миграции батчами:** приоритет — сервисы с самым высоким TCO.

### 7.3. Декомиссия

* План последовательного отключения старых прокси-компонентов, освобождение ресурсов и упрощение пайплайнов.

---

## 8. Риски и меры снижения

| Риск                              | Влияние           | Митигация                                                          |
| --------------------------------- | ----------------- | ------------------------------------------------------------------ |
| Неготовность команд к DSL         | Ошибки в правилах | Обучение + валидация `anygate check` + шаблоны                     |
| Регрессия производительности      | Падение SLO       | Бенчи до/после, канареечный ввод, план отката                      |
| Несовместимость нестандартных фич | Срыв миграции     | Карта соответствий nginx/traefik/HAProxy, RFC на исключения        |
| Безопасность поставок             | Уязвимости        | Подписанные релизы, SBOM, процесс SECURITY.md                      |
| Недооценка операционной экономии  | Неочевидный ROI   | Логирование фактических трудозатрат по релизам/инцидентам в пилоте |

---

## 9. KPI/метрики успеха

* **TCO:** снижение совокупной стоимости владения L7-слоем по ежемесячным затратам.
* **Ops:** сокращение часов на релиз и изменений в конфиге.
* **SRE:** снижение MTTR и/или частоты инцидентов; стабильность квантилей.
* **Security:** уменьшение «отклонений аудита» и ускорение патч-менеджмента.
* **Adoption:** доля сервисов, переведённых на AnyGate, и отказ от старых прокси.

---

## 10. Инвестиции и бюджет

* **Пилот:** ограниченные часы Platform/SRE/Sec/Docs, стенд бенчей, подготовка шаблонов.
* **Масштабирование:** автоматизация миграций, обучение, сопровождение первых волн.
* **Ожидаемая окупаемость:** в базовом сценарии — в пределах годового горизонта при фиксированных вводных (см. модели сценарием).

> Подробная смета в приложении **A** с привязкой к внутренним ставкам.

---

## 11. Решение и запрос на одобрение

Просим **Sponsor/Finance** утвердить:

1. Внедрение AnyGate как корпоративного L7-стандарта.
2. Бюджет пилота и масштаба из Приложения A.
3. KPI и отчётность по разделу 9.
4. Декомиссию наследуемых компонентов по плану.

**Подписи (утверждение):**

* Sponsor: _____________________ Дата: __________
* Finance: _____________________ Дата: __________
* CPTO: _______________________ Дата: __________

---

## Приложение A — Шаблон расчёта (для Finance)

| Переменная               | Описание                      | Значение | Источник данных   |
| ------------------------ | ----------------------------- | -------- | ----------------- |
| N_nodes                  | Узлов с L7-слоем              |          | CMDB/облако       |
| Cost_cpu_ram_before      | Стоимость CPU/RAM/узел/мес до |          | Биллинг           |
| Cost_cpu_ram_after       | Стоимость после               |          | Оценка пилота     |
| Ops_rate                 | Стоимость часа SRE/платформы  |          | HR/Finance        |
| Ops_hours_release_before | Часы/релиз до                 |          | Журналы изменений |
| Ops_hours_release_after  | Часы/релиз после              |          | Пилот             |
| Releases_per_month       | Релизов/мес                   |          | Roadmap           |
| Incidents_before         | Инцидентов/мес до             |          | Incident DB       |
| Incidents_after          | После                         |          | Пилот             |
| MTTR_before              | Часы/инцидент до              |          | Incident DB       |
| MTTR_after               | После                         |          | Пилот             |
| Business_cost_downtime   | Стоимость часа простоя        |          | Finance           |
| Migration_cost           | Разовые затраты               |          | Проект            |

---

## Приложение B — Матрица соответствий (миграции)

* **nginx:** `proxy_pass`, `root/index`, `try_files` → `routes` + `static`/`proxy`; `add_header` → плагин `headers`.
* **traefik:** роутеры/сервис/мидлвары → `groups` + `plugins`.
* **HAProxy:** ACL/бекенды/балансировка → `proxy` с `least-conn/rr`, health-checks.

---

## Приложение C — План коммуникаций

* **Стейкхолдеры:** CPTO, Platform, SRE, Sec, POs, Finance.
* **Артефакты:** квартальные обзоры KPI, отчёты пилота, инструкции миграции, обновления шаблонов конфигов.
* **Каналы:** внутренний портал, рассылки инженерным и продактовым командам, тех.коллы по вехам.

---

**Примечание:** документ рассчитан на утверждение Sponsor/Finance; при подписании значения в Приложении A должны быть заполнены внутренними данными и согласованы с владельцами метрик.
